# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'screen.ui'
#
# Created by: PyQt5 UI code generator 5.15.4
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.

from PyQt5 import QtCore, QtGui, QtWidgets
from gui.widgets.Button100x100 import Button100x100
from gui.widgets.RankingTable import RankingTable
import os
from client.controller import execute_action

dirname = os.path.dirname(__file__)
image_folder = os.path.join(dirname, "../images")


class UI_EndgameScreen(object):
    def setupUi(self, MainWindow):
        MainWindow.setObjectName("MainWindow")
        # MainWindow.resize(1280, 960)
        MainWindow.setFixedWidth(1280)
        MainWindow.setFixedHeight(960)
        MainWindow.setAutoFillBackground(False)
        self.centralwidget = QtWidgets.QWidget(MainWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.centralwidget.setStyleSheet("background-color: #F0F0F0;")

        # title
        self.titleInformation = QtWidgets.QLabel(self.centralwidget)
        self.titleInformation.setGeometry(QtCore.QRect(0, 50, 1280, 100))
        self.titleInformation.setText("")
        self.titleInformation.setPixmap(QtGui.QPixmap(
            os.path.join(image_folder, "./leader-board.png")))
        self.titleInformation.setAlignment(QtCore.Qt.AlignCenter)
        self.titleInformation.setObjectName("titleInformation")

        # restart button
        self.restartBtn = Button100x100(self.centralwidget)
        self.restartBtn.setName("restartBtn")
        self.restartBtn.setImage(os.path.join(image_folder, "./back-btn.png"))
        self.restartBtn.move(QtCore.QPoint(500, 700))
        self.restartBtn.hide()

        # exitBtn
        self.exitBtn = Button100x100(self.centralwidget)
        self.exitBtn.setName("exitBtn")
        self.exitBtn.setImage(os.path.join(image_folder, "./exit-btn.png"))
        self.exitBtn.move(QtCore.QPoint(590, 700))
        self.exitBtn.clicked.connect(lambda: self.handleClickExit(MainWindow))

        # table
        self.rankingTable = RankingTable(self.centralwidget)
        self.rankingTable.createHeading()
        response = execute_action("get_leaderboard",None)
        result = eval(response)
        self.rankingTable.setValue(result)

        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_leaderboard)
        self.timer.start(2000)

        # setup
        MainWindow.setCentralWidget(self.centralwidget)

        self.retranslateUi(MainWindow)
        QtCore.QMetaObject.connectSlotsByName(MainWindow)

    def retranslateUi(self, MainWindow):
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "MainWindow"))

    def update_leaderboard(self):
        response = execute_action("get_leaderboard",None)
        result = eval(response)
        self.rankingTable.setValue(result)
        print("updated!")

    def handleClickExit(self, MainWindow):
        self.timer.stop()
        MainWindow.close()
